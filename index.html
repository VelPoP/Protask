<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ProTask Elite</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20,400,0,0" />
    <style>
        :root {
            --md-primary: #0061A4; --md-on-primary: #ffffff; --md-surface: #FDFCFF;
            --md-surface-variant: #E0E2EC; --md-on-surface: #1A1C1E; --md-outline: #74777F;
            --md-error: #BA1A1A; --md-success: #198754;
            --priority-high: #BA1A1A; --priority-med: #E28100; --priority-low: #198754;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--md-surface); margin: 0; padding: 16px; padding-bottom: 520px;
            color: var(--md-on-surface); user-select: none;
        }

        header { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; }
        h1 { font-size: 28px; font-weight: 400; margin: 0; letter-spacing: -0.5px; }

        .progress-track { height: 10px; background: var(--md-surface-variant); border-radius: 10px; margin: 16px 0; overflow: hidden; }
        #progressBar { height: 100%; background: var(--md-primary); width: 0%; transition: width 0.6s; }

        .task-card {
            background: #f0f4f9; border-radius: 20px; padding: 16px; margin-bottom: 12px;
            display: flex; flex-direction: column; border-left: 6px solid transparent;
            transition: 0.2s;
        }
        .task-card.p-high { border-left-color: var(--priority-high); }
        .task-card.p-med { border-left-color: var(--priority-med); }
        .task-card.p-low { border-left-color: var(--priority-low); }

        .task-main { display: flex; align-items: center; gap: 12px; }
        .check-circle { width: 28px; height: 28px; border: 2px solid var(--md-outline); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .check-circle.checked { background: var(--md-success); border-color: var(--md-success); color: white; }
        
        .task-info { flex-grow: 1; }
        .task-title { font-size: 16px; font-weight: 600; }
        .task-time { font-size: 13px; color: var(--md-primary); font-weight: 600; display: flex; align-items: center; gap: 4px; }

        .bottom-sheet { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-radius: 32px 32px 0 0; padding: 20px; box-shadow: 0 -8px 32px rgba(0,0,0,0.1); z-index: 100; }
        .input-group { background: #f0f4f9; border-radius: 16px; padding: 8px 16px; margin-bottom: 12px; display: flex; align-items: center; gap: 12px; }
        input[type="text"] { background: none; border: none; width: 100%; height: 40px; font-size: 16px; outline: none; flex: 1; }
        
        .priority-pill { padding: 6px 14px; border-radius: 20px; font-size: 11px; font-weight: bold; border: 1px solid var(--md-outline); background: white; cursor: pointer; }
        .priority-pill.active[data-p="high"] { background: var(--priority-high); color: white; border-color: var(--priority-high); }
        .priority-pill.active[data-p="med"] { background: var(--priority-med); color: white; border-color: var(--priority-med); }
        .priority-pill.active[data-p="low"] { background: var(--priority-low); color: white; border-color: var(--priority-low); }

        .save-btn { background: var(--md-primary); color: white; border: none; width: 100%; height: 56px; border-radius: 28px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 12px; }
        .btn-icon { background: none; border: none; color: var(--md-outline); cursor: pointer; padding: 8px; border-radius: 50%; }
        .done { opacity: 0.4; filter: grayscale(1); }
    </style>
</head>
<body>

<header>
    <h1>ProTask</h1>
    <div style="display:flex; gap: 4px;">
        <button class="btn-icon" onclick="initNotifications()" id="bellBtn"><span class="material-symbols-outlined">notifications</span></button>
    </div>
</header>

<div class="progress-track"><div id="progressBar"></div></div>
<div id="list"></div>

<div class="bottom-sheet">
    <div class="input-group">
        <input type="text" id="tTitle" placeholder="Task description...">
    </div>

    <div style="display:flex; gap:8px; margin-bottom:12px; align-items:center;">
        <span style="font-size:11px; font-weight:bold; color:var(--md-outline)">PRIORITY:</span>
        <div class="priority-pill active" data-p="low" onclick="setPriority('low')">Low</div>
        <div class="priority-pill" data-p="med" onclick="setPriority('med')">Med</div>
        <div class="priority-pill" data-p="high" onclick="setPriority('high')">High</div>
    </div>

    <div style="display:flex; gap:8px; margin-bottom:8px;">
        <input type="date" id="tDate" style="background:#f0f4f9; border:none; padding:12px; border-radius:16px; flex:1.5;">
        <div style="display:flex; align-items:center; background:#f0f4f9; padding:0 12px; border-radius:16px; flex:1;">
            <input type="number" id="tHour" style="width:30px; border:none; background:none; font-weight:bold;" value="12">
            <b>:</b>
            <input type="number" id="tMin" style="width:30px; border:none; background:none; font-weight:bold;" value="00">
            <select id="tPeriod" style="border:none; background:none; font-weight:bold; color:var(--md-primary)">
                <option>AM</option><option>PM</option>
            </select>
        </div>
    </div>

    <button class="save-btn" onclick="saveTask()">
        <span class="material-symbols-outlined">add</span>
        <span>Schedule Task</span>
    </button>
</div>

<script type="module">
    // Firebase Cloud Logic
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyB1u-t7oQLWDg333noZcmtscbOo8fftPYE",
        authDomain: "protask-97ac8.firebaseapp.com",
        projectId: "protask-97ac8",
        storageBucket: "protask-97ac8.firebasestorage.app",
        messagingSenderId: "18921043127",
        appId: "1:18921043127:web:7780ee8e5b7ce919684932"
    [cite_start]}; [cite: 1]

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const tasksCol = collection(db, "tasks");

    let selectedPriority = 'low';

    // Global functions for HTML buttons
    window.setPriority = (p) => {
        selectedPriority = p;
        document.querySelectorAll('.priority-pill').forEach(el => el.classList.toggle('active', el.dataset.p === p));
    };

    window.saveTask = async () => {
        const title = document.getElementById('tTitle').value;
        if(!title) return;
        
        const dateVal = document.getElementById('tDate').value;
        let h = parseInt(document.getElementById('tHour').value);
        const m = document.getElementById('tMin').value.padStart(2, '0');
        const p = document.getElementById('tPeriod').value;
        if (p === "PM" && h < 12) h += 12;
        if (p === "AM" && h === 12) h = 0;
        const fullTime = `${dateVal}T${String(h).padStart(2, '0')}:${m}`;

        await addDoc(tasksCol, {
            title,
            time: fullTime,
            priority: selectedPriority,
            done: false,
            createdAt: Date.now()
        });

        document.getElementById('tTitle').value = "";
    };

    window.toggle = async (id, currentState) => {
        await updateDoc(doc(db, "tasks", id), { done: !currentState });
    };

    window.del = async (id) => {
        if(confirm("Delete task?")) await deleteDoc(doc(db, "tasks", id));
    };

    // Real-time Cloud Listener
    const q = query(tasksCol, orderBy("time", "asc"));
    onSnapshot(q, (snapshot) => {
        const list = document.getElementById('list');
        list.innerHTML = "";
        let tasksCount = 0;
        let doneCount = 0;

        snapshot.forEach(docSnap => {
            const t = docSnap.data();
            const id = docSnap.id;
            tasksCount++;
            if(t.done) doneCount++;

            const card = document.createElement('div');
            card.className = `task-card p-${t.priority} ${t.done ? 'done' : ''}`;
            card.innerHTML = `
                <div class="task-main">
                    <div class="check-circle ${t.done ? 'checked' : ''}" onclick="toggle('${id}', ${t.done})">
                        <span class="material-symbols-outlined" style="font-size:18px">check</span>
                    </div>
                    <div class="task-info">
                        <div class="task-title">${t.title}</div>
                        <div class="task-time">${t.time.replace('T', ' ')}</div>
                    </div>
                    <button class="btn-icon" onclick="del('${id}')"><span class="material-symbols-outlined">delete</span></button>
                </div>
            `;
            list.appendChild(card);
        });
        
        document.getElementById('progressBar').style.width = (tasksCount ? (doneCount/tasksCount)*100 : 0) + '%';
    });

    window.initNotifications = () => {
        if (!("Notification" in window)) return alert("Not supported.");
        Notification.requestPermission();
    };

    window.onload = () => {
        document.getElementById('tDate').value = new Date().toISOString().split('T')[0];
    };
</script>
</body>
</html>